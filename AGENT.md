# AI å”ä½œæŒ‡å¼• (Agent Collaboration Guide)

æœ¬å°ˆæ¡ˆæ˜¯ä¸€å€‹åŸºæ–¼å¤š Agent æ¶æ§‹çš„ç¸½ç¶“èˆ‡é æ¸¬å¸‚å ´åˆ†æç³»çµ±ï¼ˆMacro & Prediction Market Analysisï¼‰ã€‚ä»¥ä¸‹æ˜¯èˆ‡ Cursor AI å”ä½œæ™‚çš„æœ€é«˜æº–å‰‡ã€æ¶æ§‹è¦ç¯„èˆ‡é–‹ç™¼æµç¨‹ã€‚

## ğŸ“š å°ˆæ¡ˆæ–‡ä»¶å°è¦½

è«‹åœ¨é€²è¡Œä»»ä½•é–‹ç™¼ä»»å‹™å‰ï¼Œå‹™å¿…å„ªå…ˆé–±è®€ä»¥ä¸‹æ–‡ä»¶ä»¥ç¶­æŒé‚è¼¯ä¸€è‡´æ€§ï¼š

### æ ¸å¿ƒç®¡ç†æ–‡ä»¶ï¼ˆå¿…è®€ï¼‰

| æª”æ¡ˆ | ç”¨é€” | ä½•æ™‚æŸ¥çœ‹ |
|------|------|----------|
| `README_Main_System.md` | å°ˆæ¡ˆç¸½è¦½ã€ç³»çµ±æ¶æ§‹ã€æ•¸æ“šæµå‘ç¸½åœ– | åˆæ¬¡æ¥è§¸å°ˆæ¡ˆæˆ–ä¿®æ”¹æ•´é«”æ¶æ§‹æ™‚ |
| `TODO.md` | ç•¶å‰é–‹ç™¼é€²åº¦ã€å„ªå…ˆç´šã€å·²å®ŒæˆåŠŸèƒ½ | æ¯æ¬¡é–‹å§‹æ–°ä»»å‹™å‰ï¼Œéœ€æ›´æ–°ç‹€æ…‹ |
| `config.py` | æ ¸å¿ƒé…ç½®ã€API é‡‘é‘°ç®¡ç†ã€è·¯å¾‘å®šç¾© | éœ€è¦æ–°å¢ API æˆ–ä¿®æ”¹å…¨åŸŸè¨­å®šæ™‚ |

### Agent é–‹ç™¼è¦æ ¼ï¼ˆé‚è¼¯ç´°ç¯€ï¼‰

| æª”æ¡ˆ | è² è²¬é ˜åŸŸ | æ ¸å¿ƒæŠ€è¡“é» |
|------|----------|------------|
| `Spec_Agent_Fed_Watcher.md` | è²¨å¹£æ”¿ç­–èˆ‡åˆ©ç‡åˆ†æ | è¯æº–æœƒé æœŸå·®ã€ç¾å‚µæ®–åˆ©ç‡æ›²ç·š |
| `Spec_Agent_Data_Analyst.md` | ç¶“æ¿ŸæŒ‡æ¨™èˆ‡é€šè†¨è§£è®€ | FRED API, è»Ÿ/ç¡¬è‘—é™¸é‚è¼¯åˆ¤æ–· |
| `Spec_Agent_Prediction_Specialist.md` | Polymarket æƒ…ç·’ç›£æ¸¬ | Gamma API, é æ¸¬å¸‚å ´æ©Ÿç‡æ•æ‰ |
| `Spec_Agent_Correlation_Expert.md` | è³‡ç”¢é€£å‹•èˆ‡æŒå€‰åˆ†æ | è·¨è³‡ç”¢ç›¸é—œä¿‚æ•¸ã€æŒå€‰æ›éšªåˆ†æ |
| `Spec_Agent_Editor_In_Chief.md` | å ±å‘Šç¸½çµèˆ‡é‚è¼¯å¯©æ ¸ | çŸ›ç›¾æª¢æ¸¬ã€å°ˆæ¥­æŠ•ç ”é¢¨æ ¼æ’°å¯« |

### é–‹ç™¼è¼”åŠ©

| æª”æ¡ˆ | ç”¨é€” | ä½•æ™‚æŸ¥çœ‹ |
|------|------|----------|
| `error_log.md` | å·²è§£æ±ºçš„æŠ€è¡“å•é¡Œèˆ‡ API é™·é˜±è¨˜éŒ„ | é‡åˆ° API é€£ç·šæˆ– LLM è§£æéŒ¯èª¤æ™‚ |

## ğŸ’» ä»£ç¢¼é¢¨æ ¼è¦ç¯„

### èªè¨€èˆ‡ç·¨ç¢¼æ¨™æº–

- **è¨»è§£èˆ‡æ–‡æª”å­—ä¸² (Docstrings)**ï¼šçµ±ä¸€ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚
- **å‘½åè¦ç¯„**ï¼š
  - è®Šæ•¸èˆ‡å‡½æ•¸ï¼šè‹±æ–‡ `snake_case`ï¼ˆä¾‹å¦‚ï¼š`fetch_macro_events`ï¼‰ã€‚
  - é¡åˆ¥åç¨±ï¼šè‹±æ–‡ `PascalCase`ï¼ˆä¾‹å¦‚ï¼š`PolymarketCollector`ï¼‰ã€‚
  - å¸¸æ•¸ï¼šå…¨å¤§å¯« `SCREAMING_SNAKE_CASE`ã€‚
- **æª”æ¡ˆç·¨ç¢¼**ï¼šUTF-8ï¼ˆç„¡ BOMï¼‰ï¼ŒLF æ›è¡Œç¬¦ã€‚

### éåŒæ­¥ Python æ…£ä¾‹

æœ¬å°ˆæ¡ˆé«˜åº¦ä¾è³´éåŒæ­¥ I/Oï¼Œè«‹éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š

```python
# âœ… æ¨è–¦å¯«æ³•ï¼šçµåˆ Pydantic èˆ‡éåŒæ­¥ç•°å¸¸è™•ç†
from typing import List, Optional
from pydantic import BaseModel

class MarketData(BaseModel):
    title: str
    probability: float

async def fetch_prediction_data(category: str) -> List[MarketData]:
    """
    ç²å–é æ¸¬å¸‚å ´æ•¸æ“šä¸¦é©—è­‰æ ¼å¼
    
    Args:
        category: å¸‚å ´é¡åˆ¥
        
    Returns:
        List[MarketData]: ç¶“éé©—è­‰çš„æ•¸æ“šåˆ—è¡¨
    """
    try:
        async with httpx.AsyncClient(timeout=10.0) as client:
            response = await client.get(f"{BASE_URL}/markets", params={"q": category})
            response.raise_for_status()
            raw_data = response.json()
            
            # ä½¿ç”¨ Pydantic é€²è¡Œæ•¸æ“šè§£æèˆ‡é©—è­‰
            return [MarketData(**item) for item in raw_data]
            
    except httpx.HTTPStatusError as e:
        logger.error(f"API å›å‚³éŒ¯èª¤ç‹€æ…‹: {e.response.status_code}")
        return []
    except Exception as e:
        logger.error(f"æœªé æœŸçš„éŒ¯èª¤: {str(e)}")
        return []
```

### é¡å‹æç¤º (Type Hints)

å¼·çƒˆå»ºè­°ä½¿ç”¨ Python é¡å‹æç¤ºï¼ˆType Hintsï¼‰ã€‚æ‰€æœ‰ Agent çš„åˆ†æå‡½æ•¸å¿…é ˆæ˜ç¢ºå®šç¾©å‚³å…¥èˆ‡å›å‚³çš„ Schemaã€‚

## ğŸ—‚ï¸ å°ˆæ¡ˆæ¶æ§‹èˆ‡è¨­è¨ˆæ¨¡å¼

### æ¨¡çµ„è·è²¬åŠƒåˆ† (Modularization)

```
macro-daily-robot/
â”œâ”€â”€ main.py                 # Orchestratorï¼šè² è²¬ async ä»»å‹™ç·¨æ’èˆ‡æµç¨‹ç®¡ç†
â”œâ”€â”€ config.py               # Settingsï¼šåŸºæ–¼ Pydantic Settings çš„é…ç½®ç®¡ç†
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ collectors/         # æ•¸æ“šæ¡é›†å±¤ (I/O Bound)
â”‚   â”‚   â”œâ”€â”€ base_collector.py  # çµ±ä¸€çš„ Request é‚è¼¯èˆ‡é‡è©¦æ©Ÿåˆ¶
â”‚   â”‚   â”œâ”€â”€ polymarket_data.py # è™•ç† Gamma API
â”‚   â”‚   â””â”€â”€ fred_data.py       # è™•ç† FRED API
â”‚   â”œâ”€â”€ agents/             # é‚è¼¯åˆ†æå±¤ (CPU/LLM Bound)
â”‚   â”‚   â”œâ”€â”€ base_agent.py      # å®šç¾© LLM èª¿ç”¨ä»‹é¢èˆ‡æ¨¡æ¿æ¸²æŸ“
â”‚   â”‚   â”œâ”€â”€ fed_agent.py       # åˆ©ç‡èˆ‡æ”¿ç­–é‚è¼¯
â”‚   â”‚   â””â”€â”€ editor_agent.py    # ç¸½çµèˆ‡æ ¼å¼åŒ–
â”‚   â”œâ”€â”€ schema/             # æ•¸æ“šå®šç¾©å±¤
â”‚   â”‚   â””â”€â”€ models.py          # çµ±ä¸€çš„ Pydantic æ¨¡å‹å®šç¾©
â”‚   â””â”€â”€ utils/              # å·¥å…·å±¤
â”‚       â”œâ”€â”€ logger.py          # æ—¥èªŒæ ¼å¼åŒ–
â”‚       â””â”€â”€ formatters.py      # Markdown èˆ‡æ•¸å­—æ ¼å¼åŒ–å·¥å…·
â”œâ”€â”€ data_cache/             # æš«å­˜åŸå§‹ JSON (å¿«å–æ©Ÿåˆ¶)
â””â”€â”€ outputs/                # æœ€çµ‚ç”Ÿæˆçš„ Markdown å ±å‘Š
```

### æ ¸å¿ƒè¨­è¨ˆæ¨¡å¼

- **Orchestrator Pattern**ï¼š`main.py` ä½œç‚ºæŒ‡æ®å®˜ï¼Œä¸åŸ·è¡Œå…·é«”æ¥­å‹™ï¼Œåƒ…è² è²¬å•Ÿå‹•éåŒæ­¥ä»»å‹™ (`asyncio.gather`)ã€‚
- **Strategy Pattern**ï¼šä¸åŒçš„ Agent å¯¦ç¾ `BaseAgent` çš„ `analyze()` æ–¹æ³•ï¼Œè®“åˆ†æé‚è¼¯å¯æ›¿æ›ã€‚
- **Cache-Aside Pattern**ï¼šæ¡é›†å™¨å„ªå…ˆè®€å– `data_cache/` ä¸­æœªéæœŸçš„ JSONï¼Œæ¸›å°‘å°å¤–éƒ¨ API çš„è² æ“”ã€‚

## ğŸ”§ é–‹ç™¼å·¥ä½œæµç¨‹

### æ–°å¢åŠŸèƒ½/Agent æ™‚

1. **æ›´æ–° TODO.md**ï¼šæ¨™è¨˜ç•¶å‰æ­£åœ¨é–‹ç™¼çš„ä»»å‹™èˆ‡å„ªå…ˆç´šã€‚
2. **å®šç¾© Schema**ï¼šåœ¨ `src/schema/` ä¸­å®šç¾©æ•¸æ“šæ¨¡å‹ï¼Œç¢ºä¿è³‡æ–™æµç©©å®šã€‚
3. **é–‹ç™¼ Collector**ï¼šå¯¦ä½œæ•¸æ“šæŠ“å–è…³æœ¬ï¼Œä¸¦é€²è¡Œå–®é«”æ¸¬è©¦ç¢ºä¿ JSON çµæ§‹æ­£ç¢ºã€‚
4. **é–‹ç™¼ Agent**ï¼šæ’°å¯«åˆ†æé‚è¼¯ï¼Œä¸¦ä½¿ç”¨ Mock æ•¸æ“šé©—è­‰ Prompt è¼¸å‡ºçš„ç©©å®šæ€§ã€‚
5. **æ•´åˆèˆ‡è¼¸å‡º**ï¼šåœ¨ `main.py` ä¸­æ›è¼‰æ–° Agentï¼Œä¸¦æ¸¬è©¦å ±å‘Šç”Ÿæˆã€‚

### é‡åˆ°éŒ¯èª¤æ™‚

1. **æª¢æŸ¥æ—¥èªŒ**ï¼šæŸ¥çœ‹æ§åˆ¶å°è¼¸å‡ºçš„ç•°å¸¸å †æ£§ã€‚
2. **æ›´æ–° error_log.md**ï¼šè¨˜éŒ„éŒ¯èª¤ç¾è±¡ã€åŸå› ï¼ˆå¦‚ API Rate Limitï¼‰åŠè§£æ±ºæ–¹æ¡ˆã€‚
3. **å¯¦ä½œé™ç´š**ï¼šç¢ºä¿å³ä½¿æŸå€‹ Agent å¤±æ•—ï¼Œæ•´é«”å ±å‘Šä»èƒ½ç”Ÿæˆï¼ˆå„ªé›…é™ç´šï¼‰ã€‚

## ğŸ“ Git Commit è¦ç¯„ (ç¹é«”ä¸­æ–‡)

### Commit Message æ ¼å¼

```
<é¡å‹>: <ç°¡çŸ­æè¿°>

[å¯é¸çš„è©³ç´°èªªæ˜]
```

### é¡å‹ (Type) å®šç¾©

| é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| **æ–°å¢** | æ–°é–‹ç™¼åŠŸèƒ½ã€Agent æˆ–æ¡é›†å™¨ | `æ–°å¢: å¯¦ä½œ Polymarket æ•¸æ“šæ¡é›†å™¨` |
| **ä¿®æ­£** | Bug ä¿®å¾©ã€é‚è¼¯éŒ¯èª¤ä¿®è£œ | `ä¿®æ­£: è™•ç†ç¾å‚µæ®–åˆ©ç‡æ›²ç·šå€’æ›è¨ˆç®—éŒ¯èª¤` |
| **æ–‡ä»¶** | æ–‡ä»¶æ›´æ–°ã€READMEã€Spec èª¿æ•´ | `æ–‡ä»¶: æ›´æ–°ä¸»ç·¨ Agent çš„è¨­è¨ˆè¦æ ¼æ›¸` |
| **é‡æ§‹** | ä»£ç¢¼å„ªåŒ–ã€æ¶æ§‹èª¿æ•´ã€ä¸æ”¹è®ŠåŠŸèƒ½ | `é‡æ§‹: æå– Agent å…±ç”¨çš„ Prompt æ¸²æŸ“é‚è¼¯` |
| **ç¶­è­·** | æ›´æ–°ä¾è³´ã€ç’°å¢ƒé…ç½®ã€é›œé …èª¿æ•´ | `ç¶­è­·: æ›´æ–° OpenAI SDK ç‰ˆæœ¬` |
| **å„ªåŒ–** | æ€§èƒ½æå‡ã€Token æ¶ˆè€—æ¸›å°‘ | `å„ªåŒ–: å¯¦ä½œæ•¸æ“šåˆ†æ®µè™•ç†ä»¥ç¯€çœ Context` |

## ğŸ›¡ï¸ éŒ¯èª¤è™•ç†èˆ‡å®‰å…¨åŸå‰‡

### API èª¿ç”¨æº–å‰‡

- **é‡è©¦æ©Ÿåˆ¶**ï¼šå¿…é ˆå¯¦ä½œè‡³å°‘ 3 æ¬¡çš„æŒ‡æ•¸é€€é¿é‡è©¦ (Exponential Backoff)ã€‚
- **è¶…æ™‚è¨­å®š**ï¼šæ‰€æœ‰å¤–éƒ¨ API è«‹æ±‚å¿…é ˆè¨­ç½® timeout (é è¨­ 10s)ã€‚
- **è³‡æ–™é©—è­‰**ï¼šåš´ç¦ç›´æ¥ä½¿ç”¨ API å›å‚³çš„ JSON é€²è¡Œé‹ç®—ï¼Œå¿…é ˆç¶“é Pydantic è§£æã€‚

### å®‰å…¨æ€§åŸå‰‡

- **é‡‘é‘°ä¿è­·**ï¼šçµ•å°ç¦æ­¢åœ¨ä»£ç¢¼ä¸­å¯«æ­» API Keyã€‚`.env` å¿…é ˆåŠ å…¥ `.gitignore`ã€‚
- **æ•æ„Ÿè³‡è¨Š**ï¼šæ—¥èªŒä¸­åš´ç¦è¼¸å‡ºåŒ…å« `apiKey`, `token` æˆ–ç”¨æˆ¶å€‹äººæŒå€‰ç´°ç¯€çš„å…¨é‡ Responseã€‚

## ğŸ§ª æ¸¬è©¦åŸå‰‡

### æ¸¬è©¦è…³æœ¬ä½ç½®

æ‰€æœ‰çš„å–®é«”æ¸¬è©¦æ‡‰æ”¾åœ¨ `test_scripts/` ç›®éŒ„ï¼š

- `test_polymarket.py`: é©—è­‰ API è§£æé‚è¼¯ã€‚
- `test_prompts.py`: æ¸¬è©¦å„å€‹ Agent çš„ Prompt å›å‚³æ˜¯å¦ç¬¦åˆ JSON æ ¼å¼ã€‚

### æ¸¬è©¦ç¯„æœ¬

```python
async def test_agent_output():
    """é©—è­‰ Agent è¼¸å‡ºæ˜¯å¦ç¬¦åˆ Pydantic æ¨¡å‹"""
    agent = FedAgent()
    result = await agent.analyze(mock_data)
    assert isinstance(result, AnalysisSchema)
    print("âœ… åˆ†ææ¨¡å‹é©—è­‰é€šé")
```

## ğŸ“Œ ç’°å¢ƒå·¥å…·é€ŸæŸ¥

### uv ç®¡ç† (æ¨è–¦)

```bash
uv sync                 # åŒæ­¥å°ˆæ¡ˆä¾è³´
uv add httpx pydantic   # æ–°å¢å¥—ä»¶
uv run main.py          # åŸ·è¡Œä¸»ç¨‹å¼
```

### Windows ç’°å¢ƒæ³¨æ„äº‹é …

è‹¥åœ¨ Windows æœ¬åœ°åŸ·è¡Œï¼Œè«‹ç¢ºä¿ç’°å¢ƒè®Šæ•¸è¨­å®š `PYTHONUTF8=1`ã€‚

åŸ·è¡ŒæŒ‡ä»¤ï¼š
```powershell
$env:PYTHONUTF8=1; uv run python main.py
```

---

**ğŸ“… æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.1  
**ğŸ¤– é–‹ç™¼ä»£ç†**ï¼šCursor Agent (Macro Intelligence)
